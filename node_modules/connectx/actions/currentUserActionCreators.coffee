
Dispatcher = require 'connectx/dispatcher'
{ActionType} = require 'connectx/config'

{EntityApi} = require 'connectx/remotes'

{debounce} = require 'throttle-debounce'

saveUser = debounce 500, (user) ->
  EntityApi.putEntity user
    .then updateUser, failUser

updateUser = (user) ->
  user.id = user._id
  user.type = 'user'
  Dispatcher.handleServerAction
    type: ActionType.UserUpdate
    user: user

failUser = (user) ->
  console.log 'oh noooooo'

module.exports =
  updateUser: (user) ->
    Dispatcher.handleClientAction
      type: ActionType.UserUpdateClient
      user: user
    saveUser user
