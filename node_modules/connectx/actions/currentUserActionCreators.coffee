
Dispatcher = require 'connectx/dispatcher'
{ActionType} = require 'connectx/config'

{EntityApi} = require 'connectx/remotes'

updateUser = (err, res) ->
  Dispatcher.handleServerAction
    type: ActionType.UserUpdate
    user: user

failUser = (user) ->
  console.log 'oh noooooo'


module.exports =
  updateUser: (user) ->
    # TODO: Add calls to remote to update other stuff!
    # TODO: Use Bacon.js to throttle this
    Dispatcher.handleClientAction
      type: ActionType.UserUpdateClient
      user: user
    EntityApi.putEntity user
      .then updateUser
      .catch failUser
