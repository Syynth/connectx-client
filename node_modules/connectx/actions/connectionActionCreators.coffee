NotificationActionCreators = require './notificationActionCreators'
Dispatcher = require 'connectx/dispatcher'

guid = require 'guid'

{ActionType} = require 'connectx/config'

{ConnectionApi} = require 'connectx/remotes'

module.exports =

  createConnection: (from, to) ->
    clientId = guid.create()
    NotificationActionCreators.postNotification message: "Sending request from #{from.name} to #{to.name}"
    Dispatcher.handleClientAction
      type: ActionType.ConnectionSentClient
      from: from
      pending: true
      clientId: clientId
      to: to
    ConnectionApi.createConnection from, to, {admin: false}
      .then ->
        Dispatcher.handleServerAction
          type: ActionType.ConnectionCreated
          from: from
          to: to
          clientId: clientId
          pending: true
