
Dispatcher = require 'connectx/dispatcher'
Router = require 'connectx/router'
{ActionType} = require 'connectx/config'

SessionApi = null

recieveLoginSuccess = (user) ->
  user.type = 'user'
  Dispatcher.handleServerAction
    type: ActionType.UserLogin
    user: user
    entity: user

module.exports =
  logout: ->
    Dispatcher.handleClientAction
      type: ActionType.UserLogout
  tryLogin: (email, password) ->
    Dispatcher.handleClientAction
      type: ActionType.UserLoginAttempt
      email: email
      password: password
    SessionApi.postLogin {email, password}, (usr) -> recieveLoginSuccess usr
  recieveLoginSuccess: recieveLoginSuccess
  tryRegister: (user) ->
    SessionApi.postRegister user

{SessionApi} = require 'connectx/remotes'
