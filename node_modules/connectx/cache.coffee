_ = require 'lodash'

# TODO: Consider making a memory only version of this
class Cache
  constructor: (@data = {}) ->
    @mem = _.clone @data
  # returns every item that is true for *predicate
  query: (predicate) ->
    @get key for key, val of @mem when predicate val
  get: (key) ->
    return @data[key] if @data[key]
    return @data[key] = @mem[key]
  set: (key, val) ->
    @data[key] = val
    @mem[key] = val
  unset: (key, val) ->
    delete @data[key]
    delete @mem[key]
  clear: -> @data = {}

module.exports = Cache
