req = require 'superagent'
{ApiUrl} = require 'connectx/config'
{stubs, token} = require './helpers'
_ = require 'lodash'
guid = require 'guid'
Q = require 'q'

querystring = require 'querystring'

module.exports =

  uploadFile: (file, cb) ->
    deferred = Q.defer()

    req.post "#{ApiUrl}/file"
      .withCredentials()
      .set 'CONNECTX-AUTH', token()
      .attach 'file', file
      .end (err, res) ->
        return deferred.reject err if err or res.statusType isnt 2
        deferred.resolve res.text
    deferred.promise.nodeify cb
    return deferred.promise
