guid = require 'guid'
{CurrentUserStore} = require 'connectx/stores'
_ = require 'lodash'

num = -> Math.floor(Math.random() * 10)

entropy = (bits) ->
  res = ""
  for n in [0..bits]
    res += num
  return res

emails = ['gmail', 'yahoo', 'msn', 'aol', 'hotmail', 'earthlink']

tlds = ['com', 'net', 'org', 'gov', 'co.uk']

module.exports =
  token: -> CurrentUserStore.getCurrentUser()?.token
  ok: (err, res) -> !err? and res.statusType is 2
  stubs:
    getRandomError: (failureRate = 0.5) ->
      if Math.random() < failureRate
        {message: 'Stub!'}
      else
        null
    getNetworkDelay: (offset, variability)->
      (500 + offset) + Math.random() * (300 + variability)
    getServerId: -> "ServerId#{guid.create().value}"
    getRandomUser: (seed = {}) ->
      usr =
        _id: guid.create()
        email: "#{entropy(10)}@#{emails[num() % 6]}.#{tlds[num() % 5]}"
        name: "#{Math.random().toString 16} #{Math.random().toString 16}"
        password: guid.create()
      return _.extend {}, usr, seed
