# @cjsx React.DOM

React = require 'react'
Header = require '../header'
Footer = require '../footer'
Main = require '../main'
{Link, RouteHandler, State} = require 'react-router'
{EntityActionCreators} = require 'connectx/actions'
{CurrentUserStore, GroupStore, ConnectionStore} = require 'connectx/stores'
{AutoStoreListener, VerifyRoutes} = require 'connectx/mixins'
SearchForm = require 'connectx/components/searchForm'
GroupHeader = require './group/header'

module.exports = React.createClass
  mixins: [State, (AutoStoreListener CurrentUserStore), (AutoStoreListener GroupStore)]
  statics:
    willTransitionTo: (transition, params) ->
      new VerifyRoutes(transition, params)
        .isLoggedIn()
        .isEntityViewable params.id, 'group'
  render: ->
    entity = GroupStore.getOrDefault @getParams().id
    admin  = ConnectionStore.isAdmin CurrentUserStore.getCurrentUser(), entity
    admin |= ConnectionStore.isAdmin CurrentUserStore.getCurrentActor(), entity # in case entities can own other entitys
    <div className="body_wrapper">
      <Header><GroupHeader entity={entity} admin={admin} /></Header>
      <Main>
        <RouteHandler current={CurrentUserStore.getCurrentActor()} admin={admin} entity={entity} />
      </Main>
      <Footer />
    </div>
