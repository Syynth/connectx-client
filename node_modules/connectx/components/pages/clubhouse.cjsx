# @cjsx React.DOM

React = require 'react'
Header = require '../header'
Footer = require '../footer'
Main = require '../main'
ClubhouseHeader = require './clubhouse/header'
{CurrentUserStore} = require 'connectx/stores'
StoreListener = require 'connectx/mixins/storeListener'
{RouteHandler} = require 'react-router'

{ConnectionActionCreators} = require 'connectx/actions'


Clubhouse = module.exports = React.createClass
  mixins: [StoreListener CurrentUserStore]
  onChange: -> @forceUpdate()
  statics:
    willTransitionTo: (transition, element) ->
      unless CurrentUserStore.isLoggedIn()
        transition.redirect 'home'
      else
        ConnectionActionCreators.searchIncomingConnectionsTo CurrentUserStore.getCurrentUser()
  render: ->
    e = CurrentUserStore.getCurrentUser()
    c = CurrentUserStore.getCurrentActor()
    <div className="body_wrapper">
      <Header><ClubhouseHeader entity={CurrentUserStore.getCurrentUser()} /></Header>
      <Main>
        <RouteHandler current={c} entity={e} />
      </Main>
      <Footer />
    </div>
