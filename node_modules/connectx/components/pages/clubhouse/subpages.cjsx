React = require 'react'
{Link} = require 'react-router'
{EnsureRequestQuery} = require 'connectx/mixins'
TwoColumn = require 'connectx/components/twoColumn'
ThreeColumn = require 'connectx/components/threeColumn'
Bullitin = require 'connectx/components/bullitin'
UserDataForm = require './userDataForm'
AboutDisplay = require 'connectx/components/aboutDisplay'
{CurrentUserStore} = require 'connectx/stores'
{
  GroupList,
  UserList,
  CourseList,
  EventList,
  GroupForm,
  CourseForm,
  EventForm
} = require 'connectx/components/entity'
Inbox = require 'connectx/components/inbox'
Gallery = require 'connectx/components/gallery'
Privacy = require 'connectx/components/privacy'
sub = require '../subTemplates'

{EntityActionCreators} = require 'connectx/actions'


getProps = (title = "", requestTitle = "") ->
  title: title
  requestTitle: requestTitle
  data:
    current: CurrentUserStore.getCurrentActor() # current is the one to be acting as
    entity: CurrentUserStore.getCurrentUser() # enitty is the one to be rendered
    admin: true
    type: 'strong'
    create: true

fetchUser = componentWillMount: -> EntityActionCreators.fetchEntity @props.entity.id, @props.entity.type
mixins = [EnsureRequestQuery, fetchUser]

About = React.createClass
  mixins: mixins
  render: ->
    props = getProps "About Me"
    <sub.About {...props} />

Courses = React.createClass
  mixins: mixins
  render: ->
    props = getProps 'My Courses', 'My Course Invitations'
    <sub.Courses {...props} />

Friends = React.createClass
  mixins: mixins
  render: ->
    props = getProps 'My Friends', 'My Friend Requests'
    <sub.Users {...props} />

Groups = React.createClass
  mixins: mixins
  render: ->
    props = getProps 'My Groups', 'My Group Invitiations'
    <sub.Groups {...props} />

Events = React.createClass
  mixins: mixins
  render: ->
    props = getProps 'My Events', 'My Event Invitations'
    <sub.Events {...props} />

Main = React.createClass
  mixins: mixins
  render: ->
    props = getProps()
    props.data.admin = false
    <ThreeColumn {...props.data}>
      <Bullitin title="My Groups"><GroupList {...props.data} /></Bullitin>
      <Bullitin title="My Events"><EventList {...props.data} /></Bullitin>
      <Bullitin title="My Courses"><CourseList {...props.data} /></Bullitin>
    </ThreeColumn>

Messages = React.createClass
  mixins: mixins
  render: ->
    props = getProps 'My Messages'
    <sub.Messages {...props} />

Photos = React.createClass
  mixins: mixins
  render: ->
    props = getProps 'My Photos', 'Upload Photos'
    <sub.Photos {...props} />

Settings = React.createClass
  mixins: mixins
  render: ->
    props = getProps()
    <TwoColumn>
      <Bullitin title="Settings">
        <UserDataForm {...props.data} />
      </Bullitin>
      <Bullitin title="Privacy">
        <Privacy {...props.data} />
      </Bullitin>
    </TwoColumn>

module.exports = { About, Courses, Friends, Groups, Events, Main, Messages, Photos, Settings }
