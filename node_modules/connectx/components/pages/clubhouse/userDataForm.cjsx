# @cjsx React.DOM

React = require 'react'
_ = require 'lodash'
{SessionActionCreators, CurrentUserActionCreators} = require 'connectx/actions'
{Navigation} = require 'react-router'

UserDataForm = module.exports = React.createClass
  mixins: [Navigation]
  logout: ->
    SessionActionCreators.logout()
    @transitionTo 'home'
  updateUser: (ev) -> # TODO: Add a updateUserAddress method that just adds diff = {address: {}} and mutates that
    diff = {}
    diff[ev.target.name] = ev.target.value
    CurrentUserActionCreators.updateUser _.extend {}, @props.entity, diff
  updateUserAddress: (ev) ->
    location = {}
    location[ev.target.name] = ev.target.value
    user = @props.entity
    user.location = _.extend {}, @props.entity.location, location
    CurrentUserActionCreators.updateUser user
  render: ->
    <form className="form listview settings">
      <p className="generic">
        <span className="col2 first">
          <label htmlFor="name">Full Name</label>
          <input ref="name" maxLength="20" name="name" onChange={@updateUser} placeholder="Full name" type="text" value={@props.entity.name} />
        </span>
      </p>
      <p className="generic">
        <span className="col1">
          <label htmlFor="description">About me</label>
          <input ref="description" name="description" onChange={@updateUser} placeholder="tell us about yourself" type="text" value={@props.entity.description} />
        </span>
      </p>
      <div className="generic">
        <section className="col3">
          <label htmlFor="city">City</label>
          <input ref="city" name="city" onChange={@updateUserAddress} value={@props.entity.location.city} placeholder="" type="text" />
        </section>
        <section className="col3">
          <label htmlFor="state">State</label>
          <input ref="state" name="state" type="text" placeholder="" onChange={@updateUserAddress} value={@props.entity.location.state} />
        </section>
        <section className="col3">
          <label htmlFor="zip">Zip</label>
          <input ref="zip" name="zip" placeholder="" type="text" onChange={@updateUserAddress} value={@props.entity.location.zip} />
        </section>
      </div>
      <div className="clearfix generic"></div>
      <p className="generic">
        <a className="logout" onClick={@logout}>
          <i className="fa fa-sign-out"></i>
          <span>Logout</span>
        </a>
      </p>
    </form>
