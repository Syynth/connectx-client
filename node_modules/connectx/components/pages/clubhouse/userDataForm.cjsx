# @cjsx React.DOM

React = require 'react'
_ = require 'lodash'
{SessionActionCreators, CurrentUserActionCreators} = require 'connectx/actions'
{Navigation} = require 'react-router'

UserDataForm = module.exports = React.createClass
  mixins: [Navigation]
  logout: ->
    SessionActionCreators.logout()
    @transitionTo 'home'
  updateUser: (ev) -> # TODO: Add a updateUserAddress method that just adds diff = {address: {}} and mutates that
    diff = {}
    diff[ev.target.name] = ev.target.value
    CurrentUserActionCreators.updateUser _.extend {}, @props.entity, diff
  render: ->
    <form className="form listview settings">
      <p className="generic">
        <span className="col2 first">
          <label for="name">Full Name</label>
          <input ref="name" maxlength="20" name="name" onChange={@updateUser} placeholder="Full name" type="text" value={@props.entity.name} />
        </span>
      </p>
      <p className="generic">
        <span className="col1">
          <label for="description">About me</label>
          <input name="description" onChange={@updateUser} placeholder="tell us about yourself" type="text" value={@props.entity.description} />
        </span>
      </p>
      <div className="generic">
        <section className="col3">
          <label for="city">City</label>
          <input name="city" onChange={@updateUser} value={@props.entity.city} placeholder="" type="text" />
        </section>
        <section className="col3">
          <label for="state">State</label>
          <input name="state" type="text" onChange={@updateUser} value={@props.entity.state} />
        </section>
        <section className="col3">
          <label for="zip">Zip</label>
          <input name="zip" placeholder="" type="text" onChange={@updateUser} value={@props.entity.zip} />
        </section>
      </div>
      <div className="clearfix generic"></div>
      <p className="generic">
        <a className="logout" onClick={@logout}>
          <i className="fa fa-sign-out"></i>
          <span>Logout</span>
        </a>
      </p>
    </form>
