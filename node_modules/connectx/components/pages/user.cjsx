# @cjsx React.DOM

React = require 'react'
Header = require '../header'
Footer = require '../footer'
Main = require '../main'
UserHeader = require './user/header'
{CurrentUserStore, UserStore} = require 'connectx/stores'
{AutoStoreListener} = require 'connectx/mixins'
{RouteHandler} = require 'react-router'


Clubhouse = module.exports = React.createClass
  mixins: [AutoStoreListener CurrentUserStore]
  statics:
    willTransitionTo: (transition, element) ->
      unless CurrentUserStore.isLoggedIn()
        transition.redirect 'home'
      # request user from store
      # was it missing?
      # # yes
      # # transition.wait Q.defer() [NetworkStore.getPromise -> Q.defer]
  render: ->
    <div className="body_wrapper">
      <Header><UserHeader user={CurrentUserStore.getCurrentUser()} /></Header>
      <Main>
        <RouteHandler />
      </Main>
      <Footer />
    </div>
