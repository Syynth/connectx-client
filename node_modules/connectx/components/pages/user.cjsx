# @cjsx React.DOM

React = require 'react'
Header = require '../header'
Footer = require '../footer'
Main = require '../main'
UserHeader = require './user/header'
{EntityActionCreators} = require 'connectx/actions'
{CurrentUserStore, UserStore} = require 'connectx/stores'
{AutoStoreListener} = require 'connectx/mixins'
{RouteHandler, State} = require 'react-router'

module.exports = React.createClass
  mixins: [State, AutoStoreListener UserStore]
  statics:
    willTransitionTo: (transition, params) ->
      unless CurrentUserStore.isLoggedIn()
        transition.redirect 'home'
      usr = UserStore.getByIdOrDefault params.id
      if (usr.failed)
        transition.redirect '404'
      else
        EntityActionCreators.fetchEntity usr.id, 'user'
  render: ->
    usr = UserStore.getByIdOrDefault @getParams().id
    <div className="body_wrapper">
      <Header><UserHeader user={usr} /></Header>
      <Main>
        <RouteHandler current={CurrentUserStore.getCurrentActor()} entity={usr} />
      </Main>
      <Footer />
    </div>
