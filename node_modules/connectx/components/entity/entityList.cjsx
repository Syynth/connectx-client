# @cjsx React.DOM

React = require 'react'
{ConnectionStore} = require 'connectx/stores'
{AutoStoreListener} = require 'connectx/mixins'
Icon = require 'connectx/components/icon'
_ = require 'lodash'

PostList = module.exports = React.createClass
  mixins: [AutoStoreListener(ConnectionStore)]
  getClasses: ->
    classes = {}
    switch @props.entityType
      when 'course'
        classes['fa-flag'] = true
      when 'event'
        classes['fa-calendar'] = true
      else
        classes["fa-#{@props.entityType}"] = true
    return classes
  propTypes:
    entity: React.PropTypes.object.isRequired
    connectionType: React.PropTypes.string.isRequired
    entityType: React.PropTypes.string.isRequired
  render: ->
    <ul className="list_wrapper">
    {
      if (@props.type is 'strong')
        query = ConnectionStore.getByType @props.entity.id, @props.entityType
      else if (@props.type is 'outbound')
        query = ConnectionStore.getByType @props.entity.id, @props.entityType, {pending: true}
      else if (@props.type is 'inbound')
        query = ConnectionStore.incoming @props.entity.id, @props.entityType
      list = query.map (e) =>
          React.createElement @props.itemType, _.extend({}, @props, e, {key: e.id})
      if list.length is 0
        <section className="b_content_wrapper listview3">
          <div className="wrapper">
            <p className="wrapper empty">
              <Icon {...@getClasses()} />
            </p>
            <p className="desc">No {@props.entityType}s found</p>
          </div>
          <p className="question"> {### TODO: Make this a tooltip ###}
            <Icon fa-question-circle />
          </p>
        </section>
      else
        list
    }
    </ul>
