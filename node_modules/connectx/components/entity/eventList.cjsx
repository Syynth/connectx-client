
# @cjsx React.DOM

React = require 'react/addons'
_ = require 'lodash'
EntityList = require './entityList'

{EventStore} = require 'connectx/stores'

{Link} = require 'react-router'
{AutoStoreListener, StoreListener, DebugProps, ImageUrl, EnsureFetch, DeleteConnection} = require 'connectx/mixins'

EventFetch = EnsureFetch EventStore
Listener = AutoStoreListener EventStore

mixins = [DebugProps, ImageUrl, DeleteConnection, AutoStoreListener(EventStore), EnsureFetch(EventStore)]

EventView = React.createClass
  mixins: mixins
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="event" params={id: @props.id}>
        <h3 className ="grid-80 c-green lh-4 brad-5-px bs-lv-1 va-c ">Event: {@props.name}</h3>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @props} />
        </figure>
      </Link>
    </li>

EventAdminView = React.createClass
  mixins: mixins
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="event" params={id: @props.id}>
        <h3 className ="grid-60 c-green lh-4 brad-5-px bs-lv-1 va-c ">Event: {@props.name} (Admin)</h3>
        <button onClick={@deleteConnection} className="grid-20 c-green connect_btn red brad-5-px bg-green">Remove</button>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @props} />
        </figure>
      </Link>
    </li>

EventRequestView = React.createClass
  mixins: mixins
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="event" params={id: @props.id}>
        <h3 className ="grid-40 c-green lh-4 brad-5-px bs-lv-1 va-c ">Event: {@props.name} (Request)</h3>
        <button onClick={@acceptRequest} className="grid-20 c-white connect_btn green brad-5-px bg-green">Accept</button>
        <button onClick={@deleteRequest} className="grid-20 connect_btn red brad-5-px bg-green">Decline</button>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @props} />
        </figure>
      </Link>
    </li>

module.exports = React.createClass
  getItemViewType: ->
    if @props.type is 'strong'
      if @props.admin then EventAdminView else EventView
    else
      EventRequestView
  render: ->
    <EntityList {...@props} itemType={@getItemViewType()} connectionType={@props.type} entityType="event" />
