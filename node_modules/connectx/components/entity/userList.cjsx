
# @cjsx React.DOM

React = require 'react/addons'
_ = require 'lodash'
EntityList = require './entityList'

{UserStore} = require 'connectx/stores'

{Link} = require 'react-router'
{AutoStoreListener, StoreListener, DebugProps, ImageUrl, EnsureFetch, DeleteConnection} = require 'connectx/mixins'

UserFetch = EnsureFetch UserStore
Listener = AutoStoreListener UserStore

mixins = [DebugProps, ImageUrl, DeleteConnection, AutoStoreListener(UserStore), EnsureFetch(UserStore)]

UserView = React.createClass
  mixins: mixins
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="user" params={id: @props.id}>
        <h3 className ="grid-80 c-green lh-4 brad-5-px bs-lv-1 va-c ">Name: {@props.name}</h3>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @props} />
        </figure>
      </Link>
    </li>

UserAdminView = React.createClass
  mixins: mixins
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="user" params={id: @props.id}>
        <h3 className ="grid-60 c-green lh-4 brad-5-px bs-lv-1 va-c ">Name: {@props.name} (Admin)</h3>
        <button onClick={@deleteConnection} className="grid-20 c-green connect_btn red brad-5-px bg-green">Remove</button>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @props} />
        </figure>
      </Link>
    </li>

UserRequestView = React.createClass
  mixins: mixins
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="user" params={id: @props.id}>
        <h3 className ="grid-60 c-green lh-4 brad-5-px bs-lv-1 va-c ">Name: {@props.name} (Request)</h3>
        <button className="grid-10 c-green connect_btn brad-5-px bg-green">Accept</button>
        <button onClick={@deleteRequest} className="grid-10 c-green connect_btn red brad-5-px bg-green">Decline</button>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @props} />
        </figure>
      </Link>
    </li>

module.exports = React.createClass
  mixins: [AutoStoreListener UserStore]
  getItemViewType: ->
    if @props.type is 'strong'
      if @props.admin then UserAdminView else UserView
    else
      UserRequestView
  render: ->
    <EntityList {...@props} itemType={@getItemViewType()} connectionType={@props.type} entityType="user" />
