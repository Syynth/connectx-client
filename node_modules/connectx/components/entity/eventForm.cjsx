# @cjsx React.DOM

React = require 'react'
AddButton = require './addButton'
{Modal} = require 'react-bootstrap'
{FormState, FormHelpers} = require 'connectx/mixins'
{EntityActionCreators} = require 'connectx/actions'
{DatePicker, DatePickerInput} = require 'react-datepicker-component'

module.exports = React.createClass
  render: -> <AddButton form={<EventForm />}>Create an event</AddButton>

EventForm = React.createClass
  mixins: [FormHelpers, FormState]
  getInitialState: -> {}
  cancelForm: (ev) ->
    ev.preventDefault()
    ev.stopPropagation()
    @props.onRequestHide()
  createEvent: (ev) ->
    ev.preventDefault()
    ev.stopPropagation()
    if @validate()
      data = @serializeForm()
      data.location = {}
      for prop in 'city state zip address'.split ' '
        data.location[prop] = data[prop]
        delete data[prop]

      EntityActionCreators.createEntity 'event', data
      @clearForm()
      @props.onRequestHide()
  render: ->
    <Modal onRequestHide={@props.onRequestHide} title="Create An Event">
      <div className="modal_body">
        <form>
          <h3 className="modal_title">New Event Information</h3>
          <div className="modalForm">
            <p className="col1 modal_section">
              <span>
                <label htmlFor="name">Event Name</label>
                <input type="text" name="name" placeholder="Event Name" />
              </span>
              <span>
                <label htmlFor="about_text">Event Description</label>
                <textarea name="about_text" placeholder="Brief Description" />
              </span>
            </p>
            <p className="col1 modal_section">
              <span>
                <label htmlFor="location">Street Address</label>
                <input type="text" name="location" placeholder="Street Address" />
              </span>
            </p>
            <div className="col3 combo modal_section clearfix">
              <section className="col3">
                <label htmlFor="city">City</label>
                <input type="text" name="city" placeholder="city" />
              </section>
              <section className="col3">
                <label htmlFor="state">State</label>
                <input type="text" name="state" placeholder="state" />
              </section>
              <section className="col3">
                <label htmlFor="zip">Zip</label>
                <input type="text" name="zip" placeholder="zip" />
              </section>
              <div className="modal_section time clearfix">
                <section className="col3">
                  <label htmlFor="date">Event Date</label>
                  <DatePicker />
                  <DatePickerInput  />
                  {###<input className="datepicker" type="text" name="date" placeholder="Date" />###}
                </section>
                <section className="col3">
                  <label htmlFor="s_time">Start Time</label>
                  <input type="text" name="s_time" placeholder="start time" />
                </section>
                <section className="col3">
                  <label htmlFor="e_time">End Time</label>
                  <input type="text" name="e_time" placeholder="end time" />
                </section>
              </div>
            </div>
            <p className="btn_group modal_section">
              <button className="create" onClick={@createEvent}>Create Event</button>
              <button className="cancel" onClick={@cancelForm}>Cancel</button>
            </p>
          </div>
        </form>
      </div>
    </Modal>
