
# @cjsx React.DOM

React = require 'react/addons'
_ = require 'lodash'
EntityList = require './entityList'
{GroupStore} = require 'connectx/stores'
{Link} = require 'react-router'
{StatefulStoreListener, StoreListener, DebugProps, ImageUrl} = require 'connectx/mixins'

GroupView = React.createClass
  mixins: [DebugProps, ImageUrl, StatefulStoreListener GroupStore]
  getStateFromStores: -> group: GroupStore.getOrDefault @props.group.id
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="group" params={id: @props.group.id}>
        <h3 className ="grid-80 c-green lh-4 brad-5-px bs-lv-1 va-c ">Group name: {@state.group.name}</h3>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @state.group} />
        </figure>
      </Link>
    </li>

GroupAdminView = React.createClass
  mixins: [DebugProps, ImageUrl, StatefulStoreListener GroupStore]
  getStateFromStores: -> group: GroupStore.getOrDefault @props.group.id
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <h3 className ="grid-80 c-green lh-4 brad-5-px bs-lv-1 va-c ">Group name: {@state.group.name}</h3>

      <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
        <img className ="grid-100 brad-5-px" src={@getProfilePhoto @state.group} />
      </figure>
    </li>

GroupRequestView = React.createClass
  mixins: [DebugProps, ImageUrl, StatefulStoreListener GroupStore]
  getStateFromStores: -> group: GroupStore.getOrDefault @props.group.id
  render: ->
    <li>
      <Link to="group" params={id: @props.group.id}>
        {@printDebug()}
      </Link>
    </li>

module.exports = React.createClass
  getItemViewType: ->
    if @props.type is 'strong'
      if @props.admin then GroupAdminView else GroupView
    else
      GroupRequestView
  render: ->
    <EntityList {...@props} itemType={@getItemViewType()} connectionType={@props.type} entityType="group" />
