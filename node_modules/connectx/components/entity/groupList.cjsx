
# @cjsx React.DOM

React = require 'react/addons'
_ = require 'lodash'
EntityList = require './entityList'
{GroupStore} = require 'connectx/stores'
{Link} = require 'react-router'
{StatefulStoreListener, StoreListener, DebugProps, ImageUrl} = require 'connectx/mixins'

GroupView = React.createClass
  mixins: [DebugProps, ImageUrl, StatefulStoreListener GroupStore]
  getStateFromStores: -> group: GroupStore.getOrDefault @props.group
  render: ->
    <li>
      <Link to="group" params={id: @props.group}>
        <h1>Group: {@state.group.name}</h1>
        {@printDebug()}
      </Link>
    </li>

GroupAdminView = React.createClass
  mixins: [DebugProps, ImageUrl, StatefulStoreListener GroupStore]
  getStateFromStores: ->
    group: GroupStore.getOrDefault @props.group
  render: ->
    <li>
      <h2>Group: {@state.group.name}</h2>
      <img src={@getProfilePhoto @state.group} />
    </li>

GroupRequestView = React.createClass
  mixins: [DebugProps, StatefulStoreListener GroupStore]
  getStateFromStores: -> group: GroupStore.getOrDefault @props.group
  render: ->
    <li>
      <Link to="group" params={id: @props.group}>
        {@printDebug()}
      </Link>
    </li>

module.exports = React.createClass
  getItemViewType: ->
    if @props.type is 'strong'
      if @props.admin then GroupAdminView else GroupView
    else
      GroupRequestView
  render: ->
    <EntityList {...@props} itemType={@getItemViewType()} connectionType={@props.type} entityType="group" />
