
# @cjsx React.DOM

React = require 'react/addons'
_ = require 'lodash'
EntityList = require './entityList'
{GroupStore} = require 'connectx/stores'
{Link} = require 'react-router'
{AutoStoreListener, StoreListener, DebugProps, ImageUrl, EnsureFetch, DeleteConnection} = require 'connectx/mixins'

GroupFetch = EnsureFetch GroupStore
Listener = AutoStoreListener GroupStore

mixins = [DebugProps, ImageUrl, DeleteConnection, AutoStoreListener(GroupStore), EnsureFetch(GroupStore)]

GroupView = React.createClass
  mixins: mixins
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="group" params={id: @props.id}>
        <h3 className ="grid-80 c-green lh-4 brad-5-px bs-lv-1 va-c ">Group: {@props.name}</h3>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @props} />
        </figure>
      </Link>
    </li>

GroupAdminView = React.createClass
  mixins: mixins
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="group" params={id: @props.id}>
        <h3 className ="grid-60 c-green lh-4 brad-5-px bs-lv-1 va-c ">Group: {@props.name} (Admin)</h3>
        <button onClick={@deleteConnection} className="grid-20 c-green connect_btn red brad-5-px bg-green">Remove</button>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @props} />
        </figure>
      </Link>
    </li>

GroupRequestView = React.createClass
  mixins: mixins
  render: ->
    <li className= "grid-100 bg-lv-1 bs-lv-1 brad-5-px ptb-3 ">
      <Link to="group" params={id: @props.id}>
        <h3 className ="grid-40 c-green lh-4 brad-5-px bs-lv-1 va-c ">Group: {@props.name} (Request)</h3>
        <button onClick={@acceptRequest} className="grid-20 c-white connect_btn green brad-5-px bg-green">Accept</button>
        <button onClick={@deleteRequest} className="grid-20 connect_btn red brad-5-px bg-green">Decline</button>
        <figure className ="grid-20 bs-lv-1 brad-5-px bg-white of-h">
          <img className ="grid-100 brad-5-px" src={@getProfilePhoto @props} />
        </figure>
      </Link>
    </li>

module.exports = React.createClass
  getItemViewType: ->
    if @props.type is 'strong'
      if @props.admin then GroupAdminView else GroupView
    else
      GroupRequestView
  render: ->
    <EntityList {...@props} itemType={@getItemViewType()} connectionType={@props.type} entityType="group" />
