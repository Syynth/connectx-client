# @cjsx React.DOM

React = require 'react/addons'
{Tooltip, OverlayTrigger} = require 'react-bootstrap'
Icon = require 'connectx/components/icon'
{Keys} = require 'connectx/constants'
{PostActionCreators} = require 'connectx/actions'

CommentForm = module.exports = React.createClass
  getInitialState: -> text: ''
  submitComment: (ev) ->
    if ev.keyCode is Keys.Enter
      comment = @state.text.trim()
      if comment.length > 0
        PostActionCreators.createComment @props.postId,
          text: comment
          createdAt: Date.now()
          author: @props.current
        @setState text: ''
  onChange: (ev) ->
    @setState text: ev.target.value
  render: ->
    <article className="new_post">
      <ul className="clearfix comment_list"><div /></ul>
      <OverlayTrigger placement="right" overlay={if @props.failed then <Tooltip><Icon fa-warning /> Post failed to reach server</Tooltip> else <div />}>
        <input
          value={@state.text}
          onChange={@onChange}
          onKeyDown={@submitComment}
          disabled={@props.pending or @props.failed}
          className="comment_create"
          placeholder="Write a comment" />
      </OverlayTrigger>
    </article>
