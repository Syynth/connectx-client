React = require 'react'
{ImageUrl, Formatting} = require 'connectx/mixins'
Icon = require 'connectx/components/icon'
{Link} = require 'react-router'
{PostActionCreators} = require 'connectx/actions'
# {OverlayTrigger, Tooltip} = require 'react-bootstrap'
{getStore} = require 'connectx/stores'

Comment = module.exports = React.createClass
  mixins: [ImageUrl, Formatting]
  removeComment: ->
    PostActionCreators.removeComment {id: @props.getId(), postId: @props.postId}
  retryComment: ->
    if @props.failed
      PostActionCreators.retryComment @props
  # TODO: Subscribe to EntityStore to keep this in sync
  render: ->
    author = getStore(@props.author.type).getOrDefault @props.author.id
    <li>
      <div className="partition img_comment_wrapper">
        <figure className="img_fig">
          <Link to={@props.author.type} params={id: @props.author.id}>
            <img src={@getProfilePhoto author} />
          </Link>
        </figure>
      </div>
      <div className="partition comment_wrapper">
        <article className="block bot_margin_5">
          <p className="comment">
            <Link to={@props.author.type} params={id: @props.author.id}>
              {author.name}
            </Link>
            <div className="comment">
              <span>{@props.text}</span>
            </div>
          </p>
        </article>
        <article className="block clearfix">
          <div className="half">
            <p className="date">
              <img className="posted_icon" src="img/icons/post.png" />
              <span>Posted on</span>
              <span>{@formatDate @props.createdAt}</span>
            </p>
          </div>
          <div className="half">
            {
              if !@props.pending
                <p className="remove-reply del_comment" onClick={@removeComment}>
                  <Icon fa-times />
                </p>
            }
          </div>
        </article>
      </div>
    </li>
