# @cjsx React.DOM

React = require 'react'
{Modal, ModalTrigger} = require 'react-bootstrap'
{SwallowEvent, FormHelpers, FormState} = require 'connectx/mixins'
{NotificationActionCreators, SessionActionCreators} = require 'connectx/actions'
LoginModal = require './loginModal'

RegisterModal = module.exports = React.createClass
  mixins: [SwallowEvent, FormHelpers, FormState]
  getInitialState: -> email: '', name: '', password: '', password_confirm: ''
  formFields:
    email:
      required: true
      pattern: 'email'
      label: 'Email'
    name:
      required: true
      label: 'Name'
    password:
      required: true
      label: 'Password'
    password_confirm:
      required: true
      equalTo: 'password'
      label: 'Password Confirm'
      transient: true
  tryRegister: ->
    if @validate()
      data = @serializeForm()
      SessionActionCreators.tryRegister data
      @clearForm()
      @props.onRequestHide()
  render: ->
    <Modal onRequestHide={@props.onRequestHide} title="Sign up for Golf Connectx">
      <div className="login_form_wrapper">
        <div className="partition">
          <div className="subsection">
            <form className="row1" onSubmit={@swallowEvent}>
              <label>Email *</label>
              <input ref="email" placeholder="Email" type="email" name="email" value={@state.email} onChange={@onFormChange} />
              <label>Full Name *</label>
              <input ref="name" placeholder="Full Name" type="text" name="name" value={@state.name} onChange={@onFormChange} />
              <label>Password *</label>
              <input ref="password" placeholder="Password" type="password" name="password" value={@state.password} onChange={@onFormChange} />
              <label>Confirm Password *</label>
              <input ref="password_confirm" placeholder="Password" type="password" name="password_confirm" value={@state.password_confirm} onChange={@onFormChange} />
            </form>
          </div>
        </div>
        <div className="partition center">
          <img className="form_logo" src="img/logo.png" />
          <div className="subsection">
            <p className="button register_btn modal-submit" onClick={@tryRegister}>Create Account</p>
            {
              unless @props.nested
                <ModalTrigger modal={<LoginModal nested="true" />}>
                  <p><a className="modal-cancel login member">Already a member?</a></p>
                </ModalTrigger>
              else
                <p onClick={@props.onRequestClose}><a className="modal-cancel login member">Already a member?</a></p>
            }
          </div>
        </div>
      </div>
    </Modal>
