# @cjsx React.DOM

React = require 'react'
{PostStore} = require 'connectx/stores'
{AutoStoreListener, ImageUrl, Formatting} = require 'connectx/mixins'
Icon = require 'connectx/components/icon'
{Link} = require 'react-router'

Post = React.createClass
  mixins: [ImageUrl, Formatting]
  render: ->
    <article className="wall_post header one-edge-shadow">
      <div>
        <div className="hideShow partition">
          <Icon fa-minus fa-expand-o />
          <div className="clearfix" />
        </div>
      </div>
      <div className="post_cont">
        <article className="listbox main_post">
          <div className="post_top">
            <div className="img_wrapper">
              <figure className="img_fig">
                <Link to="user" params={id: @props.author.id}>
                  <img className="comment_profile_img" src={@getProfilePhoto @props.author} />
                </Link>
              </figure>
            </div>
            <div className="post_info_cont">
              <Link to="user" params={id: @props.author.id}>{@props.author.name}</Link>
              <p className="date">
                <img className="posted_icon" src="img/icons/post.png" />
                <span>Posted on</span>
                <span>{@formatDate @props.createdAt}</span>
              </p>
            </div>
          </div>
          <div className="content">
            <p className="text">{@props.text}</p>
            {
              if @props.file
                <figure>
                  <img className="upload" src={@getImageUrl @props.file} />
                </figure>
            }
          </div>
          <div className="post_bottom">
            <div className="comment_count">0 comments</div>
            <div className="remove_post">remove post</div>
          </div>
        </article>
        <article className="new_post">
          <ul className="clearfix comment_list"><div></div></ul>
          <input className="comment_create" placeholder="write a comment" />
        </article>
      </div>
    </article>

PostList = module.exports = React.createClass
  mixins: [AutoStoreListener PostStore]
  render: ->

    <div className="the_post_holder">
    {
      PostStore.getByOwnerId @props.entity.id
        .sort (a, b) -> a.createdAt < b.createdAt
        .map (p) -> <Post {...p} key={p.getId()} />
    }
    </div>
