{CurrentUserStore} = require 'connectx/stores'
{EntityActionCreators} = require 'connectx/actions'
titlecase = require 'titlecase'

dummyTransition =
  redirect: -> #noop

getStore = (type) ->
  return require('connectx/stores')["#{titlecase type}Store"]

class RouteVerifier
  constructor: (@transition, @params) ->
    @and = @
  isLoggedIn: ->
    unless CurrentUserStore.isLoggedIn()
      @transition.redirect 'home'
      @transition = dummyTransition
    return @
  isEntityViewable: (eId, eType) ->
    e = getStore(eType).getOrDefault eId
    if e.failed
      @transition.redirect '404'
      @transition = dummyTransition
    else
      EntityActionCreators.fetchEntity eId, eType
    return @

module.exports = RouteVerifier
