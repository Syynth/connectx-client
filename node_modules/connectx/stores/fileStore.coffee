
{EventEmitter} = require 'events'
Dispatcher = require 'connectx/dispatcher'
{SourceType, ActionType} = require 'connectx/constants'

BaseStore = require './baseStore'
PostStore = require './postStore'

files = {}

class FileStore extends BaseStore
  storeKey: 'FILE_STORE'
  constructor: (dispatcher) ->
    super dispatcher
  getFileForPostId: (id) -> files[id]
  dependents: [PostStore]
  handlers: [
    action: ActionType.CreatePost
    fn: (action) ->
      if action.posts[0].file
        files[action.clientId] = action.posts[0].file
  ,
    action: ActionType.UserLogout
    fn: -> files = {}
  ]

module.exports = new FileStore Dispatcher
