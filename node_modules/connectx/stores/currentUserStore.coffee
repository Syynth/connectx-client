Dispatcher = require 'connectx/dispatcher'
{SourceType, ActionType} = require 'connectx/config'

BaseStore = require './baseStore'
Cache = require 'connectx/cache'

class CurrentUserStore extends BaseStore
  storeKey: 'CURRENT_USER'
  isLoggedIn: -> @get('currentUser')?
  getCurrentUser: -> @get 'currentUser'
  getCurrentActor: -> @get 'currentActor'
  wipeCache: ->
    super()
    @commit()
  handlers: [
    action: ActionType.UserLogin
    fn: (action) ->
      @set 'currentUser', action.user
      @set 'currentActor', action.user
  ,
    action: ActionType.EntityLogin
    fn: (action) -> @set 'currentActor', action.entity
    action: ActionType.UserUpdate
    fn: (action) ->
      @set 'currentUser', action.user
  ,
    action: ActionType.UserLogout
    fn: CurrentUserStore::wipeCache
  ]

module.exports = new CurrentUserStore Dispatcher
