
{EventEmitter} = require 'events'
Dispatcher = require 'connectx/dispatcher'
{SourceType, ActionType} = require 'connectx/constants'

BaseStore = require './baseStore'

currentUser = null

class CurrentUserStore extends BaseStore
  storeKey: 'CURRENT_USER'
  constructor: ->
    currentUser = @read 'currentUser'
  isLoggedIn: -> currentUser isnt null
  getCurrentUser: -> currentUser
  handlers: [
    source: 'Server'
    type: ActionType.UserLogin
    fn: (payload) ->
      currentUser = payload.action.user
      @write 'currentUser', currentUser
      @emitChange()
  ,
    source: 'Client'
    type: ActionType.UserLogout
    fn: ->
      currentUser = null
      @write 'currentUser', currentUser
      @emitChange()
  ]

store = module.exports = new CurrentUserStore

store.dispatchToken = Dispatcher.register store.handleDispatch.bind(store)
