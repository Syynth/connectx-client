Dispatcher = require 'connectx/dispatcher'
{SourceType, ActionType} = require 'connectx/constants'

BaseStore = require './baseStore'
Cache = require 'connectx/cache'

class CurrentUserStore extends BaseStore
  storeKey: 'CURRENT_USER'
  constructor: (dispatcher) ->
    super dispatcher
    @cache = new Cache @read 'cache'
  isLoggedIn: -> @get('currentUser') isnt null
  getCurrentUser: -> @get 'currentUser'
  getCurrentActor: -> @get 'currentActor'
  handlers: [
    action: ActionType.UserLogin
    fn: (action) ->
      @set 'currentUser', action.user
      @set 'currentActor', action.user
  ,
    action: ActionType.EntityLogin
    fn: (action) -> @set 'currentActor', action.entity
    action: ActionType.UserUpdate
    fn: (action) ->
      @set 'currentUser', action.user
  ,
    action: ActionType.UserLogout
    fn: -> BaseStore::clearAll
  ]

module.exports = new CurrentUserStore Dispatcher
